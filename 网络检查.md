服务器网络连通性排查指南
概述
本文档提供了一套系统化的步骤，用于诊断和解决服务器无法访问外部网络服务（尤其是 HTTPS 网站）的问题。排查遵循从底层到上层、从简单到复杂的逻辑。

核心排查原则
分层检查：从网络底层（DNS）开始，逐步向上到应用层（SSL）

由内到外：先检查服务器自身配置，再排查外部网络限制

对比验证：在出问题的服务器和正常的机器上执行相同操作，对比结果

详细排查步骤
步骤 1：问题定义与信息收集
明确问题：记录无法访问的具体 URL

收集信息：

bash
uname -a        # 查看系统版本
curl -V         # 查看 curl 版本及支持的 SSL 库
openssl version # 查看 OpenSSL 版本
步骤 2：DNS 解析检查（Layer 4）
目的：确认域名能否正确解析为 IP 地址

命令：

bash
nslookup example.com
# 或
dig example.com +short
可能结果与对策：

成功：返回正确的 IP 地址 → 进行 步骤 3

失败（无返回或错误）：

检查 /etc/resolv.conf 文件中的 DNS 服务器配置

测试与 DNS 服务器的连通性：ping -c 4 8.8.8.8 (将 8.8.8.8 替换为你的 nameserver)

常见原因：DNS 配置错误、服务器防火墙或云安全组未放行 UDP 53 端口的出站流量

步骤 3：网络层连通性检查（Layer 3）
目的：确认服务器与目标 IP 地址之间网络是否可达

命令：

bash
ping -c 4 <目标IP>
可能结果与对策：

成功：收到回复 → 进行 步骤 4

失败（100% 丢包）：

网络路由问题或防火墙拦截 ICMP 协议（很多服务器禁 ping，因此失败不代表端口不通）

继续执行 步骤 4，以端口连通性为准

步骤 4：TCP 端口连通性检查（Layer 4）
目的：确认能否与目标服务的特定端口（如 443）建立 TCP 连接

命令：

bash
# 推荐使用 nc (netcat)
nc -zv <目标IP|域名> 443

# 或者使用 telnet (注意语法差异)
telnet <目标IP|域名> 443
可能结果与对策：

成功（succeeded! 或 看到空白屏幕）→ 说明网络和防火墙规则正常，问题 100% 出在应用层（SSL/HTTPS）→ 跳至步骤 6

失败：

Connection refused：目标端口无服务监听或目标主机防火墙明确拒绝

Connection timed out or No route to host：出站流量被拦截

对策：重点排查：

服务器本地防火墙：检查 iptables -L -n 或 firewalld (firewall-cmd --list-all)

云平台安全组（Security Group）：这是最常见的原因！ 登录云控制台，检查该服务器所属安全组的出站规则（Outbound Rules），确保已放行对 0.0.0.0/0:443 的访问

服务器代理配置：检查环境变量 http_proxy, https_proxy, no_proxy

目标防火墙：可能你的服务器 IP 被目标网站封禁。尝试从其他网络环境（如本地电脑、另一台云服务器）访问，或使用在线端口扫描工具（如 yougetsignal.com）进行对比验证

步骤 5：SSL/TLS 握手诊断（Layer 7）
目的：在 TCP 连接建立后，诊断 SSL 握手失败的具体原因

命令：

bash
openssl s_client -connect example.com:443 -servername example.com
关键错误码与解决方案：

Verify return code: 0 (ok) → SSL 握手成功。问题可能不在网络和SSL，而是应用层（如HTTP请求问题）

Verify error: unable to get local issuer certificate：

原因：缺少可信的根证书库

解决：安装 ca-certificates 包

Ubuntu/Debian: sudo apt update && sudo apt install ca-certificates

CentOS/RHEL: sudo yum install ca-certificates

unsupported protocol / wrong version number：

原因：本地 OpenSSL 版本过旧，不支持目标网站要求的 TLS 版本（如 TLS 1.2/1.3）

解决：升级系统或 OpenSSL 库

certificate has expired：

原因：1）目标网站证书过期（可能性小）；2）服务器系统时间错误（可能性极大！）

解决：使用 date 命令检查时间，并通过 ntpdate 或 chrony 同步时间

no shared cipher：

原因：双方没有共同支持的加密套件

解决：升级 OpenSSL

步骤 6：应用层访问测试
目的：使用常用工具进行最终访问测试

命令：

bash
curl -vI https://example.com
wget --debug https://example.com
观察 curl 的详细输出 (-v)，看它在哪一步失败